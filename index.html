<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>SHEEPLY Pop Tap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <!-- –ú—É–ª—å—Ç—è—à–Ω—ã–π –∫—Ä—É–≥–ª—ã–π —à—Ä–∏—Ñ—Ç -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #22d3ee, #0f172a);
      color: #0f172a;
      overflow: hidden;
    }

    #app {
      max-width: 540px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 8px;
    }

    .card {
      border-radius: 24px;
      background: radial-gradient(circle at top, #ecfeff, #e0f2fe);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.5);
      padding: 10px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #headerCard {
      flex-shrink: 0;
    }

    #gameCard {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 10px;
      background:
        radial-gradient(circle at top, #bbf7d0, #a5f3fc),
        linear-gradient(180deg, #cffafe, #bbf7d0);
    }

    #shopCard {
      flex-shrink: 0;
    }

    #topBar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    #scoreBlock {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    #scoreMain {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      font-size: 11px;
      color: #0f172a;
    }

    #canvasWrapper {
      flex: 1;
      min-height: 0;
      border-radius: 20px;
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      overflow: hidden;
      position: relative;
      margin-top: 4px;
    }

    #gameCanvas {
      display: block;
      width: 100%;
      height: 100%;
      touch-action: manipulation;
    }

    #tapHint {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #fefce8;
      background: rgba(15, 23, 42, 0.25);
      padding: 4px 10px;
      border-radius: 999px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(254,240,138,0.6);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #shopTitle {
      font-size: 14px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #shopList {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 150px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .shopItem {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.6);
      gap: 8px;
    }

    .shopInfo {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 12px;
    }

    .shopName {
      font-size: 13px;
      font-weight: 700;
    }

    .shopDesc {
      font-size: 11px;
      color: #4b5563;
    }

    .shopBtn {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 6px 14px rgba(34, 197, 94, 0.7);
      white-space: nowrap;
    }

    .shopBtn[disabled] {
      opacity: 0.5;
      box-shadow: none;
      cursor: default;
    }

    #versionNote {
      font-size: 10px;
      text-align: right;
      color: #6b7280;
    }

    @media (max-width: 420px) {
      #scoreMain {
        font-size: 18px;
      }
      .shopItem {
        padding: 5px 7px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="headerCard" class="card">
      <div id="topBar">
        <div id="scoreBlock">
          <div id="scoreMain">
            <span>üü§ –ì–æ—Ä–æ—à–∫–∏:</span>
            <span id="scoreValue">0</span>
          </div>
          <div style="display:flex; gap:6px; flex-wrap:wrap;">
            <span class="pill">üî• –ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="multValue">1x</span></span>
            <span class="pill">‚è± –ê–≤—Ç–æ: <span id="autoValue">0/—Å–µ–∫</span></span>
            <span class="pill">üëë –†–µ–∫–æ—Ä–¥: <span id="bestValue">0</span></span>
          </div>
        </div>
      </div>
    </div>

    <div id="gameCard" class="card">
      <div id="canvasWrapper">
        <div id="tapHint">–¢–∞–ø–∞–π –ø–æ –ø–æ–ø–∫–µ –æ–≤–µ—á–∫–∏ üêëüçë</div>
        <canvas id="gameCanvas"></canvas>
      </div>
    </div>

    <div id="shopCard" class="card">
      <div id="shopTitle">
        <span>üíö –£–ª—É—á—à–µ–Ω–∏—è SHEEPLY</span>
        <span style="font-size:11px; color:#6b7280;">–∫–∞–∫ –≤ Hamster, –Ω–æ –º–∏–ª–µ–µ</span>
      </div>
      <div id="shopList">
        <!-- –∑–∞–ø–æ–ª–Ω–∏–º –∏–∑ JS -->
      </div>
      <div id="versionNote">SHEEPLY Pop Tap v1</div>
    </div>
  </div>

  <script>
    // ---------- –ë–ê–ó–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ----------
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('scoreValue');
    const multEl = document.getElementById('multValue');
    const autoEl = document.getElementById('autoValue');
    const bestEl = document.getElementById('bestValue');
    const shopListEl = document.getElementById('shopList');
    const tapHintEl = document.getElementById('tapHint');

    let width = 0;
    let height = 0;

    // –ª–æ–≥–∏–∫–∞ —Å—á—ë—Ç–∞
    let totalPoops = 0;
    let bestScore = 0;
    let poopPerTap = 1;
    let pelletsPerTap = 10;
    let autoPoopsPerSec = 0;

    let lastTime = 0;
    let particles = [];
    let floatTexts = [];

    // –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ 1000, 2000, 3000...
    let lastThousandStep = 0;

    // –ø–æ–ø–∫–∞ –æ–≤—Ü—ã (—Ü–µ–Ω—Ç—Ä –∫—Ä—É–≥–∞)
    const sheep = {
      x: 0,
      y: 0,
      radius: 0
    };

    // Web Audio –¥–ª—è "–±—ç—ç—ç"
    let audioCtx = null;

    function playBaa() {
      try {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = 'triangle';
        osc.frequency.setValueAtTime(280, now);
        osc.frequency.linearRampToValueAtTime(220, now + 0.15);
        osc.frequency.linearRampToValueAtTime(260, now + 0.3);

        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.25, now + 0.03);
        gain.gain.linearRampToValueAtTime(0.0, now + 0.35);

        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now + 0.4);
      } catch (e) {
        // –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å - –ø—Ä–æ—Å—Ç–æ –º–æ–ª—á–∏–º
      }
    }

    function playTinyPop() {
      try {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(900, now);
        osc.frequency.exponentialRampToValueAtTime(300, now + 0.08);
        gain.gain.setValueAtTime(0.15, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now + 0.14);
      } catch (e) {}
    }

    // ---------- –†–ê–ó–ú–ï–¢–ö–ê CANVAS ----------
    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      width = rect.width;
      height = rect.height;

      // –ø–æ–∑–∏—Ü–∏—è –ø–æ–ø–∫–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É —á—É—Ç—å –≤—ã—à–µ)
      sheep.radius = Math.min(width, height) * 0.22;
      sheep.x = width / 2;
      sheep.y = height * 0.55;
    }

    window.addEventListener('resize', resizeCanvas);

    // ---------- –ß–¢–ï–ù–ò–ï/–°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ö–û–†–î–ê ----------
    try {
      const saved = localStorage.getItem('sheeply_pop_tap_best');
      if (saved) {
        bestScore = parseInt(saved, 10) || 0;
        bestEl.textContent = bestScore;
      }
    } catch (e) {}

    function updateHeader() {
      scoreEl.textContent = Math.floor(totalPoops);
      multEl.textContent = poopPerTap + 'x';
      autoEl.textContent = autoPoopsPerSec.toFixed(1).replace('.0','') + '/—Å–µ–∫';
      bestEl.textContent = bestScore;
    }

    // ---------- –ß–ê–°–¢–ò–¶–´-–ì–û–†–û–®–ö–ò ----------
    function spawnPellets(count, strengthMultiplier = 1) {
      const baseX = sheep.x;
      const baseY = sheep.y;
      for (let i = 0; i < count; i++) {
        const angle = (Math.random() * Math.PI) + Math.PI; // –≤–Ω–∏–∑
        const speed = (0.18 + Math.random() * 0.13) * strengthMultiplier;
        particles.push({
          x: baseX + (Math.random() - 0.5) * sheep.radius * 0.4,
          y: baseY + (Math.random() - 0.3) * sheep.radius * 0.25,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          radius: 4 + Math.random() * 3,
          rotation: Math.random() * Math.PI * 2,
          rotationSpeed: (Math.random() - 0.5) * 0.02,
          grounded: false,
          life: 8000 + Math.random() * 4000, // –∂–∏–≤—É—Ç 8-12 —Å–µ–∫—É–Ω–¥
          age: 0
        });
      }
      // –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —á–∞—Å—Ç–∏—Ü
      if (particles.length > 800) {
        particles.splice(0, particles.length - 800);
      }
    }

    function updateParticles(dt) {
      const gravity = 0.0006 * dt;
      const groundY = height * 0.92;
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.age += dt;
        if (p.age > p.life) {
          particles.splice(i, 1);
          continue;
        }
        if (!p.grounded) {
          p.vy += gravity;
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.rotation += p.rotationSpeed * dt;

          if (p.y + p.radius > groundY) {
            p.y = groundY - p.radius;
            p.vy *= -0.15; // –ª—ë–≥–∫–∏–π –æ—Ç—Å–∫–æ–∫
            p.vx *= 0.4;
            if (Math.abs(p.vy) < 0.02) {
              p.grounded = true;
            }
          }
        }
      }
    }

    function drawParticles() {
      ctx.save();
      for (const p of particles) {
        const alpha = 1 - p.age / p.life;
        ctx.globalAlpha = Math.max(0, alpha);
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.beginPath();
        ctx.ellipse(0, 0, p.radius * 0.8, p.radius * 0.6, 0, 0, Math.PI * 2);
        ctx.fillStyle = '#78350f';
        ctx.fill();
        ctx.setTransform(1, 0, 0, 1, 0, 0);
      }
      ctx.restore();
    }

    // ---------- –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –¢–ï–ö–°–¢–´ ----------
    function spawnFloatText(text, x, y, color = '#0f172a') {
      floatTexts.push({
        text,
        x,
        y,
        color,
        age: 0,
        life: 700
      });
    }

    function updateFloatTexts(dt) {
      for (let i = floatTexts.length - 1; i >= 0; i--) {
        const t = floatTexts[i];
        t.age += dt;
        t.y -= 0.04 * dt;
        if (t.age > t.life) {
          floatTexts.splice(i, 1);
        }
      }
    }

    function drawFloatTexts() {
      ctx.save();
      ctx.font = '16px "Baloo 2"';
      for (const t of floatTexts) {
        const alpha = 1 - t.age / t.life;
        ctx.globalAlpha = Math.max(0, alpha);
        ctx.fillStyle = t.color;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(t.text, t.x, t.y);
      }
      ctx.restore();
    }

    // ---------- –†–ò–°–û–í–ö–ê –§–û–ù–ê –ò –û–í–ï–ß–ö–ò-–ü–û–ü–ö–ò ----------
    function drawBackground() {
      // —Ç—Ä–∞–≤–∫–∞
      const skyHeight = height * 0.3;
      const skyGrad = ctx.createLinearGradient(0, 0, 0, skyHeight);
      skyGrad.addColorStop(0, '#a5f3fc');
      skyGrad.addColorStop(1, '#bae6fd');
      ctx.fillStyle = skyGrad;
      ctx.fillRect(0, 0, width, skyHeight);

      const fieldGrad = ctx.createLinearGradient(0, skyHeight, 0, height);
      fieldGrad.addColorStop(0, '#bbf7d0');
      fieldGrad.addColorStop(1, '#22c55e');
      ctx.fillStyle = fieldGrad;
      ctx.fillRect(0, skyHeight, width, height);

      // –ø–æ–ª–æ—Å—ã —Ç—Ä–∞–≤—ã
      ctx.save();
      ctx.globalAlpha = 0.2;
      ctx.fillStyle = '#16a34a';
      const stripeHeight = 40;
      for (let y = skyHeight + stripeHeight; y < height; y += stripeHeight * 2) {
        ctx.fillRect(0, y, width, stripeHeight);
      }
      ctx.restore();

      // –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–ª–Ω—Ü–µ
      ctx.save();
      ctx.beginPath();
      ctx.arc(width * 0.12, skyHeight * 0.3, skyHeight * 0.25, 0, Math.PI * 2);
      ctx.fillStyle = '#fde68a';
      ctx.fill();
      ctx.restore();
    }

    function drawSheepButt() {
      ctx.save();

      const r = sheep.radius;
      const x = sheep.x;
      const y = sheep.y;

      // —Ç–µ–Ω—å
      ctx.beginPath();
      ctx.ellipse(x, y + r * 0.8, r * 0.85, r * 0.45, 0, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(15,23,42,0.35)';
      ctx.fill();

      // –ø–æ–ø–∫–∞ - –¥–≤–∞ —Å–ª–æ—è –ø—É—à–∏—Å—Ç—ã—Ö –æ–±–ª–∞—á–∫–æ–≤
      const fluffGrad = ctx.createRadialGradient(
        x, y - r * 0.4, r * 0.3,
        x, y, r * 1.1
      );
      fluffGrad.addColorStop(0, '#f9fafb');
      fluffGrad.addColorStop(0.5, '#e5e7eb');
      fluffGrad.addColorStop(1, '#d4d4d8');

      ctx.beginPath();
      ctx.ellipse(x, y, r * 1.1, r, 0, 0, Math.PI * 2);
      ctx.fillStyle = fluffGrad;
      ctx.fill();

      ctx.beginPath();
      ctx.ellipse(x, y - r * 0.1, r * 0.85, r * 0.7, 0, 0, Math.PI * 2);
      ctx.fillStyle = '#f9fafb';
      ctx.fill();

      // —Ö–≤–æ—Å—Ç–∏–∫-–ø–æ–º–ø–æ–Ω
      const tailTime = Date.now() / 300;
      const tailWiggle = Math.sin(tailTime) * r * 0.06;
      const tailR = r * 0.28;

      const tailGrad = ctx.createRadialGradient(
        x, y - r * 0.4, tailR * 0.3,
        x, y - r * 0.3, tailR
      );
      tailGrad.addColorStop(0, '#ffffff');
      tailGrad.addColorStop(1, '#e5e7eb');

      ctx.beginPath();
      ctx.ellipse(x + tailWiggle, y - r * 0.25, tailR, tailR * 0.85, 0, 0, Math.PI * 2);
      ctx.fillStyle = tailGrad;
      ctx.fill();

      // –º–∏–Ω–∏-–Ω–æ–∂–∫–∏ —Å–∑–∞–¥–∏
      ctx.fillStyle = '#111827';
      const legW = r * 0.18;
      const legH = r * 0.55;
      const legY = y + r * 0.45;
      const phase = Date.now() / 150;
      const stepOffset = Math.sin(phase) * 3;

      ctx.fillRect(x - r * 0.4, legY + stepOffset, legW, legH);
      ctx.fillRect(x - r * 0.1, legY - stepOffset, legW, legH);
      ctx.fillRect(x + r * 0.2, legY + stepOffset, legW, legH);

      ctx.restore();
    }

    // –ª—ë–≥–∫–∏–π "–ø–æ–¥—Å–≤–µ—Ç" –≤–æ–∫—Ä—É–≥ –ø–æ–ø–∫–∏
    function drawSheepGlow() {
      ctx.save();
      const r = sheep.radius * 1.35;
      const grad = ctx.createRadialGradient(
        sheep.x, sheep.y, r * 0.1,
        sheep.x, sheep.y, r
      );
      grad.addColorStop(0, 'rgba(254,252,232,0.9)');
      grad.addColorStop(1, 'rgba(254,249,195,0)');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(sheep.x, sheep.y, r, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    // ---------- –¢–ê–ü –ü–û –û–í–¶–ï ----------
    function isPointInSheep(x, y) {
      const dx = x - sheep.x;
      const dy = y - sheep.y;
      return Math.sqrt(dx * dx + dy * dy) <= sheep.radius * 1.05;
    }

    function handleTap(isFromAuto = false) {
      if (!isFromAuto) {
        tapHintEl.style.display = 'none';
      }

      const gained = poopPerTap;
      const oldScore = totalPoops;
      totalPoops += gained;

      if (totalPoops > bestScore) {
        bestScore = Math.floor(totalPoops);
        try {
          localStorage.setItem('sheeply_pop_tap_best', String(bestScore));
        } catch (e) {}
      }

      spawnPellets(pelletsPerTap, 1);
      spawnFloatText('+' + gained, sheep.x, sheep.y - sheep.radius * 0.4, '#166534');

      if (!isFromAuto) {
        playTinyPop();
      }

      // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞–∂–¥—É—é 1000-–∫—É
      const thousandStep = Math.floor(totalPoops / 1000);
      if (thousandStep > lastThousandStep) {
        lastThousandStep = thousandStep;
        playBaa();
        spawnFloatText('–ë–≠–≠–≠! üíö', sheep.x, sheep.y - sheep.radius * 0.9, '#e11d48');
      }

      updateHeader();
    }

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      if (isPointInSheep(x, y)) {
        handleTap(false);
      }
    });

    canvas.addEventListener('touchstart', (e) => {
      const t = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = t.clientX - rect.left;
      const y = t.clientY - rect.top;
      if (isPointInSheep(x, y)) {
        handleTap(false);
      }
    }, { passive: true });

    // ---------- –ê–í–¢–û-–¢–ê–ô–ú–ï–† ----------
    let autoAccum = 0;

    function updateAuto(dt) {
      if (autoPoopsPerSec <= 0) return;
      autoAccum += (autoPoopsPerSec * dt) / 1000;
      if (autoAccum >= 1) {
        const toDo = Math.floor(autoAccum);
        autoAccum -= toDo;
        for (let i = 0; i < toDo; i++) {
          handleTap(true);
        }
      }
    }

    // ---------- –ú–ê–ì–ê–ó–ò–ù ----------
    const shopItems = [
      {
        id: 'tapPower',
        icon: 'üêëüí•',
        name: '–°—É–ø–µ—Ä-—Ç–∞–ø –ø–æ–ø–∫–∏',
        desc: '–ë–æ–ª—å—à–µ –≥–æ—Ä–æ—à–∫–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ç–∞–ø.',
        baseCost: 20,
        level: 0,
        effect() {
          poopPerTap += 1;
        }
      },
      {
        id: 'pelletStorm',
        icon: 'üü§üåß',
        name: '–ì–æ—Ä–æ—à–µ—á–Ω—ã–π –¥–æ–∂–¥—å',
        desc: '–ë–æ–ª—å—à–µ –≥–æ—Ä–æ—à–∫–æ–≤ –≤—ã–ª–µ—Ç–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ.',
        baseCost: 30,
        level: 0,
        effect() {
          pelletsPerTap += 5;
        }
      },
      {
        id: 'autoPet',
        icon: 'ü§≤',
        name: '–ê–≤—Ç–æ-–ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è',
        desc: '–ì–æ—Ä–æ—à–∫–∏ –∫–∞–ø–∞—é—Ç —Å–∞–º–∏ –ø–æ —Å–µ–±–µ.',
        baseCost: 50,
        level: 0,
        effect() {
          autoPoopsPerSec += 0.5;
        }
      },
      {
        id: 'megaTail',
        icon: '‚ú®',
        name: '–°–∏—è—é—â–∏–π —Ö–≤–æ—Å—Ç–∏–∫',
        desc: '–ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –∑–∞ —Ç–∞–ø.',
        baseCost: 120,
        level: 0,
        effect() {
          poopPerTap += 2;
        }
      }
    ];

    function getCost(item) {
      return Math.floor(item.baseCost * Math.pow(1.8, item.level));
    }

    function renderShop() {
      shopListEl.innerHTML = '';
      shopItems.forEach(item => {
        const cost = getCost(item);
        const canBuy = totalPoops >= cost;

        const row = document.createElement('div');
        row.className = 'shopItem';

        const info = document.createElement('div');
        info.className = 'shopInfo';

        const name = document.createElement('div');
        name.className = 'shopName';
        name.textContent = `${item.icon} ${item.name}`;

        const desc = document.createElement('div');
        desc.className = 'shopDesc';
        desc.textContent = `${item.desc} –£—Ä–æ–≤–µ–Ω—å: ${item.level}. –¶–µ–Ω–∞: ${cost} üü§`;

        info.appendChild(name);
        info.appendChild(desc);

        const btn = document.createElement('button');
        btn.className = 'shopBtn';
        btn.innerHTML = canBuy ? `–ö—É–ø–∏—Ç—å` : `–ú–∞–ª–æ üü§`;
        btn.disabled = !canBuy;

        btn.addEventListener('click', () => {
          const currentCost = getCost(item);
          if (totalPoops < currentCost) return;
          totalPoops -= currentCost;
          item.level += 1;
          item.effect();
          spawnFloatText('UP!', sheep.x, sheep.y - sheep.radius, '#1d4ed8');
          playTinyPop();
          updateHeader();
          renderShop();
        });

        row.appendChild(info);
        row.appendChild(btn);
        shopListEl.appendChild(row);
      });
    }

    // ---------- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ ----------
    function loop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const dt = timestamp - lastTime;
      lastTime = timestamp;

      updateAuto(dt);
      updateParticles(dt);
      updateFloatTexts(dt);

      ctx.clearRect(0, 0, width, height);
      drawBackground();
      drawSheepGlow();
      drawParticles();
      drawSheepButt();
      drawFloatTexts();

      requestAnimationFrame(loop);
    }

    // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
    resizeCanvas();
    updateHeader();
    renderShop();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
