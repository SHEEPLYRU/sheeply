<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Basket Boy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #111827;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f9fafb;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #hud {
      position: absolute;
      top: 8px;
      left: 0;
      right: 0;
      padding: 0 12px;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      z-index: 2;
      pointer-events: none;
    }
    #message {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.8);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      text-align: center;
      z-index: 2;
    }
    canvas {
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.45);
      background: linear-gradient(to top, #0f172a, #1e293b);
      touch-action: manipulation;
    }
  </style>
</head>
<body>
<div id="game-container">
  <div id="hud">
    <div>–û—á–∫–∏: <span id="score">0</span></div>
    <div>–ü–æ–ø—ã—Ç–∫–∏: <span id="lives">5</span></div>
  </div>
  <div id="message">–¢–∞–ø–Ω–∏, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –º—è—á</div>
  <canvas id="game"></canvas>
</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const scoreEl = document.getElementById("score");
  const livesEl = document.getElementById("lives");
  const messageEl = document.getElementById("message");

  // –†–∞–∑–º–µ—Ä—ã –∫–∞–Ω–≤–∞—Å–∞ –∑–∞–≤—è–∑–∞–Ω—ã –Ω–∞ –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞
  function resizeCanvas() {
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const size = Math.min(vw * 0.95, vh * 0.8);
    canvas.width = size;
    canvas.height = size * 1.4; // —á—É—Ç—å –±–æ–ª–µ–µ –≤—ã—Ç—è–Ω—É—Ç—ã–π –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
  }
  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  // –ò–≥—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  let score = 0;
  let lives = 5;
  let gameOver = false;

  const gravity = 0.45;
  const boy = {
    x: 80,
    y: () => canvas.height - 120,
    bodyHeight: 70,
    bodyWidth: 30
  };

  const hoop = {
    x: () => canvas.width - 110,
    y: () => canvas.height * 0.45,
    width: 60,
    rimThickness: 6
  };

  const ball = {
    radius: 12,
    reset() {
      this.x = boy.x + 30;
      this.y = boy.y() - 40;
      this.vx = 0;
      this.vy = 0;
      this.inAir = false;
      this.scoredThisShot = false;
    }
  };
  ball.reset();

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–∏–ª—ã –±—Ä–æ—Å–∫–∞ (–ø—Ä–æ—Å—Ç–æ –ø–æ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ –∫–ª–∏–∫–æ–≤)
  let powerPhase = 0;
  let lastShotTime = 0;

  function shoot() {
    if (ball.inAir || gameOver) return;

    const now = performance.now();
    if (now - lastShotTime < 250) return; // –∞–Ω—Ç–∏-—Å–ø–∞–º
    lastShotTime = now;

    // —Ä–∞—Å—Ç—É—â–∞—è —Å–∏–ª–∞ –±—Ä–æ—Å–∫–∞ –ø–æ —Ñ–∞–∑–∞–º
    powerPhase = (powerPhase + 1) % 3;
    const baseSpeed = 15;
    const powerMultiplier = 0.7 + powerPhase * 0.3; // 0.7, 1.0, 1.3

    const dirX = hoop.x() - ball.x;
    const dirY = hoop.y() - ball.y;
    const distance = Math.sqrt(dirX * dirX + dirY * dirY) || 1;
    const speed = baseSpeed * powerMultiplier;

    ball.vx = (dirX / distance) * speed;
    // –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞ –∫–æ—Ä–∑–∏–Ω—ã ‚Äî –ø–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
    ball.vy = (dirY / distance) * speed - 3.5;
    ball.inAir = true;
    ball.scoredThisShot = false;

    messageEl.textContent = "–ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–∞—Å—Ç—å –≤ –∫–æ–ª—å—Ü–æ!";
  }

  canvas.addEventListener("click", shoot);
  canvas.addEventListener("touchstart", (e) => {
    e.preventDefault();
    shoot();
  }, { passive: false });

  // –†–∏—Å–æ–≤–∞–Ω–∏–µ
  function drawBoy() {
    const x = boy.x;
    const y = boy.y();

    // –ù–æ–≥–∏
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#e5e7eb";
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x - 12, y + 35);
    ctx.moveTo(x + 20, y);
    ctx.lineTo(x + 32, y + 35);
    ctx.stroke();

    // –¢–µ–ª–æ
    ctx.fillStyle = "#3b82f6";
    ctx.fillRect(x - 5, y - boy.bodyHeight, boy.bodyWidth, boy.bodyHeight);

    // –†—É–∫–∏
    ctx.beginPath();
    ctx.moveTo(x + 10, y - 40);
    ctx.lineTo(ball.x, ball.y);
    ctx.stroke();

    // –ì–æ–ª–æ–≤–∞
    ctx.beginPath();
    ctx.fillStyle = "#f97316";
    ctx.arc(x + 10, y - boy.bodyHeight - 15, 14, 0, Math.PI * 2);
    ctx.fill();
  }

  function drawHoop() {
    const x = hoop.x();
    const y = hoop.y();

    // –°—Ç–æ–π–∫–∞
    ctx.fillStyle = "#78350f";
    ctx.fillRect(x + hoop.width - 10, y - 40, 10, 130);

    // –©–∏—Ç
    ctx.fillStyle = "#e5e7eb";
    ctx.fillRect(x + hoop.width - 60, y - 40, 60, 40);

    // –ö–æ–ª—å—Ü–æ
    ctx.strokeStyle = "#f97316";
    ctx.lineWidth = hoop.rimThickness;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + hoop.width, y);
    ctx.stroke();

    // –°–µ—Ç–∫–∞ (–ø—Ä–æ—Å—Ç–æ –ª–∏–Ω–∏–∏)
    ctx.strokeStyle = "rgba(248, 250, 252, 0.4)";
    ctx.lineWidth = 1;
    for (let i = 0; i <= 4; i++) {
      const t = i / 4;
      const sx = x + hoop.width * t;
      ctx.beginPath();
      ctx.moveTo(sx, y);
      ctx.lineTo(sx, y + 30);
      ctx.stroke();
    }
  }

  function drawBall() {
    ctx.beginPath();
    ctx.fillStyle = "#f97316";
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fill();

    ctx.strokeStyle = "#ea580c";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius * 0.7, 0, Math.PI * 2);
    ctx.stroke();
  }

  function drawCourt() {
    // –ø–æ–ª
    ctx.fillStyle = "#0b1120";
    ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

    // —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
    ctx.strokeStyle = "#1e293b";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, canvas.height - 60);
    ctx.lineTo(canvas.width, canvas.height - 60);
    ctx.stroke();
  }

  // –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏—è
  function checkScore() {
    const rimX = hoop.x();
    const rimY = hoop.y();
    const left = rimX;
    const right = rimX + hoop.width;
    const top = rimY - 4;
    const bottom = rimY + 10;

    const wasAbove = ball.y - ball.radius < top;
    const nowInsideHoriz = ball.x > left && ball.x < right;
    const nowBelow = ball.y - ball.radius > top;

    if (ball.inAir && !ball.scoredThisShot && wasAbove && nowInsideHoriz && nowBelow) {
      ball.scoredThisShot = true;
      score++;
      scoreEl.textContent = score;
      messageEl.textContent = "–ü–û–ü–ê–õ! üî•";

      // –ø—Ä–∏–º–µ—Ä: –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Telegram (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Game API)
      // if (window.TelegramGameProxy) { TelegramGameProxy.shareScore(score); }
    }
  }

  // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
  function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawCourt();
    drawHoop();
    drawBoy();
    drawBall();

    if (ball.inAir) {
      ball.vy += gravity;
      ball.x += ball.vx;
      ball.y += ball.vy;

      checkScore();

      // –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–µ / –≤—ã–ª–µ—Ç –∑–∞ —ç–∫—Ä–∞–Ω
      if (ball.y - ball.radius > canvas.height || ball.x - ball.radius > canvas.width + 50) {
        ball.inAir = false;
        lives--;
        livesEl.textContent = lives;

        if (lives <= 0) {
          gameOver = true;
          messageEl.textContent = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –û—á–∫–∏: ${score}. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–≥—Ä—ã.`;
        } else {
          messageEl.textContent = "–ü—Ä–æ–º–∞—Ö! –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: " + lives;
          ball.reset();
        }
      }
    }

    requestAnimationFrame(update);
  }

  // –°—Ç–∞—Ä—Ç
  ball.reset();
  update();

  // –î–ª—è Telegram WebApp –º–æ–∂–Ω–æ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
  if (window.Telegram && window.Telegram.WebApp) {
    Telegram.WebApp.expand();
    const bg = Telegram.WebApp.backgroundColor || "#111827";
    document.body.style.background = bg;
  }
</script>
</body>
</html>
